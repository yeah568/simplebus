"use strict";angular.module("busApp",["busApp.services","LocalStorageModule","ui.sortable"]),angular.module("busApp").controller("MainCtrl",["$scope","$interval","translinkAPIservice","localStorageService",function(a,b,c,d){a.response=[],a.addRoute=function(b,e){if(e.length<3){var f=e.charAt(0).toLowerCase();if("c"!==f&&"n"!==f)switch(e.length){case 1:e="00"+e;break;case 2:e="0"+e}}var g=d.get("routes");null===g&&(g=[]);var h=!1;if(g.length>0)for(var i=0;i<g.length;i++)if(g[i].stop===b&&g[i].number===e){h=!0;break}h||c.getStopInfo(b).success(function(c){c.Code||(g.push({stop:b.toString(),number:e.toString(),name:c.Name}),d.set("routes",g),a.updateEstimates())})},a.updateEstimates=function(){var b=d.get("routes");b&&b.forEach(function(a){delete a.response}),console.log(b),a.response=b,null!==b&&a.response.forEach(function(a){c.getRouteEstimates(a.stop,a.number).success(function(b){b instanceof Array?(a.response=b[0],a.response.Schedules[0].ExpectedCountdown<0&&(a.response.Schedules[0].ExpectedCountdown=0)):a.response=b})}),a.lastUpdated=new Date},a.removeRoute=function(b){a.response.splice(b,1),d.set("routes",a.response)},a.updateEstimates(),b(function(){a.updateEstimates()},6e4),a.sortableOptions={tolerance:"intersect",stop:function(){d.set("routes",a.response)},axis:"x"}}]),angular.module("busApp.services",[]).factory("translinkAPIservice",["$http",function(a){var b="https://simplebus.herokuapp.com",c={};return c.getStopEstimates=function(c){return a({method:"GET",url:b+"/api/estimate/"+c})},c.getRouteEstimates=function(c,d){return a({method:"GET",url:b+"/api/estimate/"+c+"/"+d})},c.getStopInfo=function(c){return a({method:"GET",url:b+"/api/stop/"+c})},c.getStopRouteInfo=function(c,d){return a({method:"GET",url:b+"/api/stop/"+c+"/"+d})},c}]);
